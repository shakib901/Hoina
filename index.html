<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TooL H4X0R v3</title>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- LibTL Ad SDK with your zone ID -->
    <script src='//libtl.com/sdk.js' data-zone='10613926' data-sdk='show_10613926'></script>
    
    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(to bottom, var(--tg-bg), rgba(0,0,0,0.05));
        }
        .card {
            backdrop-filter: blur(16px);
            background: rgba(255,255,255,0.85);
            border: 1px solid rgba(255,255,255,0.3);
            max-width: 380px;
            width: 95%;
        }
        @media (prefers-color-scheme: dark) {
            .card {
                background: rgba(20,20,30,0.85);
                border: 1px solid rgba(255,255,255,0.1);
            }
        }
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.5); }
            70% { box-shadow: 0 0 0 12px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .btn-dynamic {
            animation: pulseGlow 2s infinite;
        }
        .btn-dynamic-popup {
            animation: pulseGlow 2s infinite;
            animation-delay: 0.5s;
        }
        /* Ad container styling */
        .ad-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            max-width: 90%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <script>
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        
        const tp = Telegram.WebApp.themeParams;
        document.documentElement.style.setProperty('--tg-bg', tp.bg_color || '#ffffff');
        document.documentElement.style.setProperty('--tg-text', tp.text_color || '#000000');
        document.documentElement.style.setProperty('--tg-button', tp.button_color || '#2481cc');
        document.documentElement.style.setProperty('--tg-button-text', tp.button_text_color || '#ffffff');
    </script>
    
    <div class="card rounded-3xl shadow-2xl p-8 text-center">
        
        <h2 id="greeting" class="text-2xl font-semibold mb-4 opacity-0 translate-y-6 transition-all duration-800 ease-out"></h2>
        
        <h1 class="text-4xl md:text-5xl font-extrabold mb-6 bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent opacity-0 translate-y-6 transition-all duration-1000 ease-out delay-200">
           TooL H4X0R_v3
        </h1>
        
        <p class="text-base md:text-lg text-gray-600 dark:text-gray-300 mb-8 opacity-0 translate-y-6 transition-all duration-800 ease-out delay-300">
            Watch ads & earn rewards!
        </p>
        
        <div class="relative w-56 h-56 mx-auto mb-10 opacity-0 scale-90 transition-all duration-1200 ease-out delay-500 drop-shadow-xl">
            <svg class="w-56 h-56 -rotate-90">
                <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#10b981" />
                        <stop offset="100%" stop-color="#3b82f6" />
                    </linearGradient>
                </defs>
                <circle cx="112" cy="112" r="96" stroke="#e5e7eb" dark:stroke="#374151" stroke-width="28" fill="none"/>
                <circle id="progressCircle" cx="112" cy="112" r="96" stroke="url(#gradient)" stroke-width="28" fill="none"
                        stroke-dasharray="603" stroke-dashoffset="603" stroke-linecap="round"
                        class="transition-all duration-1200 ease-out"/>
            </svg>
            <div class="absolute inset-0 flex flex-col items-center justify-center">
                <div id="counter" class="text-5xl font-bold">0</div>
                <div class="text-base text-gray-600 dark:text-gray-400 mt-1">/ 60</div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 gap-5 opacity-0 translate-y-8 transition-all duration-1000 ease-out delay-700">
            <button id="watchInterstitialBtn" 
                    class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 active:scale-95 text-white font-bold py-5 px-8 rounded-2xl text-xl shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed btn-dynamic">
                Watch Interstitial Ads
            </button>
            <button id="watchPopupBtn" 
                    class="w-full bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 active:scale-95 text-white font-bold py-5 px-8 rounded-2xl text-xl shadow-xl transform hover:scale-105 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed btn-dynamic-popup">
                Watch Popup Ads
            </button>
        </div>
    </div>
    
    <!-- Limit Reached Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-gray-900 rounded-3xl p-8 max-w-sm w-full shadow-2xl transform scale-95 transition-all duration-300">
            <h2 class="text-3xl font-bold mb-5 text-red-600 text-center">Limit Reached!</h2>
            <p class="text-lg mb-8 text-center">
                You have watched 60 ads.<br><br>
                To watch more, turn on <strong>Airplane Mode</strong> for 10 seconds,<br>then turn it off.<br><br>
                This will clear the data and reset the counter.
            </p>
            <button id="resetBtn" 
                    class="w-full bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white py-5 rounded-2xl text-xl font-bold shadow-lg hover:scale-105 active:scale-95 transition-all">
                Reset Counter
            </button>
        </div>
    </div>
    
    <!-- Ad Container for better ad display -->
    <div id="adContainer" class="ad-container hidden"></div>
    
    <script>
        let adsCount = 0;
        const maxAds = 60;
        const fullCircumference = 603;
        let isAdShowing = false;
        
        const user = Telegram.WebApp.initDataUnsafe.user;
        const displayName = user?.username ? `@${user.username}` : (user?.first_name || 'Friend');
        document.getElementById('greeting').textContent = `Hello, ${displayName}! ðŸ‘‹`;
        
        function loadCount() {
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('adsDate');
            const savedCount = localStorage.getItem('adsCount');
            
            if (savedDate === today && savedCount) {
                adsCount = parseInt(savedCount);
            } else {
                adsCount = 0;
                localStorage.setItem('adsDate', today);
                localStorage.setItem('adsCount', '0');
            }
            updateUI();
        }
        
        function updateUI() {
            document.getElementById('counter').textContent = adsCount;
            const progress = (adsCount / maxAds) * 100;
            const offset = fullCircumference - (fullCircumference * progress / 100);
            document.getElementById('progressCircle').style.strokeDashoffset = offset;
            
            const btn1 = document.getElementById('watchInterstitialBtn');
            const btn2 = document.getElementById('watchPopupBtn');
            if (adsCount >= maxAds) {
                btn1.disabled = true;
                btn2.disabled = true;
                btn1.classList.remove('btn-dynamic');
                btn2.classList.remove('btn-dynamic-popup');
            } else {
                btn1.disabled = false;
                btn2.disabled = false;
                btn1.classList.add('btn-dynamic');
                btn2.classList.add('btn-dynamic-popup');
            }
        }
        
        function incrementCount() {
            adsCount++;
            localStorage.setItem('adsCount', adsCount.toString());
            updateUI();
            
            if (adsCount >= maxAds) {
                document.getElementById('modal').classList.remove('hidden');
            }
        }
        
        // Manual reset function
        function resetCounter() {
            adsCount = 0;
            localStorage.setItem('adsCount', '0');
            updateUI();
            document.getElementById('modal').classList.add('hidden');
        }
        
        // Function to check if SDK is loaded
        function isSDKLoaded() {
            return typeof show_10613926 === 'function';
        }
        
        // Function to show interstitial ad using your SDK
        function showInterstitialAd() {
            if (adsCount >= maxAds) {
                document.getElementById('modal').classList.remove('hidden');
                return;
            }
            
            if (!isSDKLoaded()) {
                alert('Ad SDK is loading... Please try again in a moment.');
                return;
            }
            
            if (isAdShowing) {
                alert('An ad is already showing. Please wait...');
                return;
            }
            
            isAdShowing = true;
            Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
            
            // Show interstitial ad using your SDK
            show_10613926()
                .then(() => {
                    // Ad watched successfully
                    incrementCount();
                    Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                    isAdShowing = false;
                })
                .catch((error) => {
                    console.log('Ad error or closed:', error);
                    // Still increment if user watched the ad
                    if (error !== 'close') {
                        Telegram.WebApp.HapticFeedback.notificationOccurred('error');
                    }
                    isAdShowing = false;
                });
        }
        
        // Function to show popup ad using your SDK
        function showPopupAd() {
            if (adsCount >= maxAds) {
                document.getElementById('modal').classList.remove('hidden');
                return;
            }
            
            if (!isSDKLoaded()) {
                alert('Ad SDK is loading... Please try again in a moment.');
                return;
            }
            
            if (isAdShowing) {
                alert('An ad is already showing. Please wait...');
                return;
            }
            
            isAdShowing = true;
            Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
            
            // Show popup ad using your SDK (with 'pop' parameter for popup ads)
            show_10613939('pop')
                .then(() => {
                    // Ad watched successfully
                    incrementCount();
                    Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                    isAdShowing = false;
                })
                .catch((error) => {
                    console.log('Popup ad error or closed:', error);
                    if (error !== 'close') {
                        Telegram.WebApp.HapticFeedback.notificationOccurred('error');
                    }
                    isAdShowing = false;
                });
        }
        
        document.getElementById('watchInterstitialBtn').onclick = showInterstitialAd;
        document.getElementById('watchPopupBtn').onclick = showPopupAd;
        document.getElementById('resetBtn').onclick = resetCounter;
        
        window.onload = () => {
            loadCount();
            document.querySelectorAll('[class*="opacity-0"]').forEach((el, i) => {
                setTimeout(() => {
                    el.classList.remove('opacity-0', 'translate-y-6', 'translate-y-8', 'scale-90');
                    el.classList.add('opacity-100', 'translate-y-0', 'scale-100');
                }, 100 + i * 150);
            });
            
            // Check if SDK is loaded
            setTimeout(() => {
                if (isSDKLoaded()) {
                    console.log('Ad SDK loaded successfully');
                } else {
                    console.log('Waiting for Ad SDK to load...');
                }
            }, 2000);
        };
    </script>
</body>
</html>
